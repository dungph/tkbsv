<html>
<head>
    <title>Thời khóa biểu sinh viên</title>
	<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/main.min.css' rel='stylesheet' />
	<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/main.min.js'></script>
    
</head>
<body>
    <p><b>Đây là ứng dụng hỗ trợ tạo file lịch (ICalendar)<br>
        Truy cập file này bằng đường dẫn "http://tkbsv.herokuapp.com/ics/[mã sinh viên]_[mật khẩu]" <br>
        Ví dụ: "http://tkbsv.herokuapp.com/ics/ct040308_123456789"<br>
    </b></p>

    <p>Bạn có thể dùng đường dẫn để thêm lịch học vào google calendar:
        <a href="https://calendar.google.com/calendar/u/0/r/settings/addbyurl">
            https://calendar.google.com/calendar/u/0/r/settings/addbyurl
        </a>
    </p>
		
    <input type="text" id="usr" placeholder="Tài khoản">
	<br>
    <input type="password" id="pwd" onsubmit="process()" placeholder="Mật Khẩu" >
	<br>
    <input type="button" id="submit" onclick="process()" value="Hiển Thị">
	<br>
	<b><p id="link"></p></b>
	<br>
	<div id="calendar"></div>

	<script>
		var input = document.getElementById("pwd");
		input.addEventListener("keyup", function(event) {
			if (event.keyCode === 13) {
				event.preventDefault();
				document.getElementById("submit").click();
			}
		});
	</script>
	<script>
		function process() {
        	let usr = document.getElementById("usr").value;
        	let pwd = document.getElementById("pwd").value;

			let url = window.location.origin + "/json/" + usr + "/" + pwd;
			let req = new XMLHttpRequest();
			req.responseType = 'json';
			req.open('GET', url, true);
			req.onload  = function() {
				var calendarEl = document.getElementById('calendar');
				var res = req.response;
				var calendar = new FullCalendar.Calendar(calendarEl, {
									    timeZone: 'local',
									    initialView: 'timeGridWeek',
										slotMinTime: '7:00:00',
										slotMaxTime: '22:00:00',
										allDaySlot: false,
									    events: res,
									    editable: true,
									    selectable: true
									  });
				calendar.render();

			document.getElementById('link').innerHTML = window.location.origin + "/ics/" + usr + "_" + pwd;
			};
			req.send(null);
		} 

    </script>

</body>

</html>
